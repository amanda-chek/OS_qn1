<!DOCTYPE html>
<html>

<head>
    <title>Indexed Allocation Game</title>
    <style>
        .block {
            width: 50px;
            height: 50px;
            border: 1px solid #000;
            display: inline-block;
            margin: 5px;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
            position: relative;
        }

        .direct {
            background-color: lightgreen;
        }

        .indirect {
            background-color: lightblue;
        }

        .multilevel {
            background-color: lightcoral;
        }

        .empty {
            background-color: white;
        }

        .selected {
            border: 2px solid red;
        }

        .file1 {
            background-color: #d1f7c4;
        }

        .file2 {
            background-color: #c4e1f7;
        }

        .arrow {
            position: absolute;
            height: 10px;
            width: 10px;
            border: 1px solid #000;
            background-color: transparent;
            border-top: 2px solid #000;
            border-right: 2px solid #000;
            transform: rotate(45deg);
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
        }

        #game-container {
            margin: 20px;
            text-align: center;
        }

        #instructions {
            margin-bottom: 20px;
            text-align: center; /* Center-align the text */
        }

        #instructions ul {
            list-style-type: none; /* Remove bullet points */
            padding: 0; /* Remove default padding */
            text-align: left; /* Align list items to the left */
            display: inline-block; /* Align the list to the center of the container */
        }

        #how-to-play {
            margin-bottom: 20px;
            text-align: left; /* Align text to the left */
            max-width: 600px; /* Optional: Limit the width of the section */
            margin: 0 auto; /* Center the section horizontally */
        }

        #how-to-play h3 {
            margin-top: 0;
        }

        #blocks-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 600px;
            margin: auto;
        }

        #controls {
            margin-top: 20px;
        }

        #feedback {
            margin-top: 10px;
            color: red;
        }

        .progress-bar {
            width: 300px;
            background-color: #f3f3f3;
            border: 1px solid #000;
            margin: 10px auto;
            text-align: left;
        }

        .progress-fill {
            height: 20px;
            background-color: #76c7c0;
            width: 0;
        }

        ol {
            padding-left: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        #allocation-status {
            margin-top: 20px;
        }

        #allocation-status div {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <div id="instructions">
            <h2>Indexed Allocation Game</h2>
            <p>Assign blocks to the following files:</p>
            <ul>
                <li>File 1: 3 direct blocks and 2 indirect blocks (multilevel)</li>
                <li>File 2: Remaining blocks</li>
            </ul>
        </div>

        <div id="how-to-play">
            <h3>How to Play</h3>
            <ol>
                <li>Click on a block to select it.</li>
                <li>Click "Assign to File 1" to assign the selected block to File 1.</li>
                <li>Click "Assign to File 2" to assign the selected block to File 2.</li>
                <li>File 1 should have exactly 3 direct blocks and 2 indirect blocks (multilevel).</li>
                <li>File 2 will automatically take the remaining blocks.</li>
                <li>Click "Reset Game" to start over.</li>
            </ol>
        </div>

        <div id="blocks-container"></div>

        <div id="allocation-status">
            <div>File 1 Direct Blocks: <span id="file1-direct-count">0</span></div>
            <div>File 1 Indirect Blocks: <span id="file1-indirect-count">0</span></div>
            <div>File 2 Blocks: <span id="file2-count">0</span></div>
        </div>

        <div id="controls">
            <button onclick="assignBlocks('file1')">Assign to File 1</button>
            <button onclick="assignBlocks('file2')">Assign to File 2</button>
            <button onclick="resetGame()">Reset Game</button>
        </div>

        <div id="progress-file1" class="progress-bar">
            <div class="progress-fill" id="progress-file1-fill"></div>
        </div>
        <div id="progress-file2" class="progress-bar">
            <div class="progress-fill" id="progress-file2-fill"></div>
        </div>

        <div id="feedback"></div>
    </div>

    <script>
        const blocksContainer = document.getElementById('blocks-container');
        const feedback = document.getElementById('feedback');
        const progressFile1Fill = document.getElementById('progress-file1-fill');
        const progressFile2Fill = document.getElementById('progress-file2-fill');
        const file1DirectCountElem = document.getElementById('file1-direct-count');
        const file1IndirectCountElem = document.getElementById('file1-indirect-count');
        const file2CountElem = document.getElementById('file2-count');
        const blocks = [];
        let selectedBlock = null;
        let file1DirectCount = 0;
        let file1IndirectCount = 0;
        let file2Count = 0;

        // Initialize 40 blocks
        for (let i = 0; i < 40; i++) {
            const block = document.createElement('div');
            block.className = 'block empty';
            block.id = `block-${i}`;
            block.onclick = () => selectBlock(i);
            blocks.push(block);
            blocksContainer.appendChild(block);
        }

        function selectBlock(index) {
            if (selectedBlock !== null) {
                blocks[selectedBlock].classList.remove('selected');
            }
            selectedBlock = index;
            blocks[selectedBlock].classList.add('selected');
        }

        function assignBlocks(file) {
            if (selectedBlock === null) {
                feedback.textContent = 'Please select a block first.';
                return;
            }

            if (file === 'file1') {
                if (blocks[selectedBlock].className.includes('file1')) {
                    feedback.textContent = 'Block already assigned to File 1.';
                    return;
                }
                if (blocks[selectedBlock].className.includes('file2')) {
                    feedback.textContent = 'Block already assigned to File 2.';
                    return;
                }
                if (file1DirectCount < 3) {
                    blocks[selectedBlock].className = 'block file1 direct';
                    file1DirectCount++;
                } else if (file1IndirectCount < 2) {
                    blocks[selectedBlock].className = 'block file1 indirect';
                    file1IndirectCount++;
                    createIndirectLink(selectedBlock);
                } else {
                    feedback.textContent = 'File 1 has reached its block limit.';
                    return;
                }
            } else if (file === 'file2') {
                if (blocks[selectedBlock].className.includes('file2')) {
                    feedback.textContent = 'Block already assigned to File 2.';
                    return;
                }
                if (blocks[selectedBlock].className.includes('file1')) {
                    feedback.textContent = 'Block already assigned to File 1.';
                    return;
                }
                blocks[selectedBlock].className = 'block file2';
                file2Count++;
            }

            updateProgress();
            updateAllocationStatus();
            checkWinCondition();
            blocks[selectedBlock].classList.remove('selected');
            selectedBlock = null;
            feedback.textContent = '';
        }

        function createIndirectLink(index) {
            // Link the indirect block to a subsequent block (for demonstration, we use the next block)
            const nextIndex = (index + 1) % blocks.length;
            const linkDiv = document.createElement('div');
            linkDiv.className = 'arrow';
            blocks[nextIndex].appendChild(linkDiv);
        }

        function updateProgress() {
            progressFile1Fill.style.width = `${(file1DirectCount + file1IndirectCount) / 5 * 100}%`;
            progressFile2Fill.style.width = `${file2Count / 35 * 100}%`;
        }

        function updateAllocationStatus() {
            file1DirectCountElem.textContent = file1DirectCount;
            file1IndirectCountElem.textContent = file1IndirectCount;
            file2CountElem.textContent = file2Count;
        }

        function checkWinCondition() {
            if (file1DirectCount === 3 && file1IndirectCount === 2 && file2Count === 35) {
                feedback.textContent = "Congratulations! You have successfully allocated all blocks.";
                alert('Congratulations! You have successfully allocated all blocks.');
            }
        }

        function resetGame() {
            blocks.forEach(block => {
                block.className = 'block empty';
                while (block.firstChild) {
                    block.removeChild(block.firstChild);
                }
            });
            file1DirectCount = 0;
            file1IndirectCount = 0;
            file2Count = 0;
            updateProgress();
            updateAllocationStatus();
            feedback.textContent = '';
        }
    </script>
</body>

</html>
